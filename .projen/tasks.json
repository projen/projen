{
  "tasks": {
    "audit": {
      "name": "audit",
      "description": "Run security audit",
      "steps": [
        {
          "exec": "npm audit --audit-level=high --omit=dev"
        }
      ]
    },
    "build": {
      "name": "build",
      "description": "Full release build",
      "steps": [
        {
          "spawn": "default"
        },
        {
          "spawn": "pre-compile"
        },
        {
          "spawn": "compile"
        },
        {
          "spawn": "post-compile"
        },
        {
          "spawn": "test"
        },
        {
          "spawn": "package"
        }
      ]
    },
    "bump": {
      "name": "bump",
      "description": "Bumps version based on latest git tag and generates a changelog entry",
      "env": {
        "OUTFILE": "package.json",
        "CHANGELOG": "dist/changelog.md",
        "BUMPFILE": "dist/version.txt",
        "RELEASETAG": "dist/releasetag.txt",
        "RELEASE_TAG_PREFIX": "",
        "BUMP_PACKAGE": "commit-and-tag-version@^12",
        "RELEASABLE_COMMITS": "git log --no-merges --oneline $LATEST_TAG..HEAD -E --grep \"^(feat|fix){1}(\\([^()[:space:]]+\\))?(!)?:[[:blank:]]+.+\""
      },
      "steps": [
        {
          "builtin": "release/bump-version"
        }
      ],
      "condition": "git log --oneline -1 | grep -qv \"chore(release):\""
    },
    "bundle:task-runner": {
      "name": "bundle:task-runner",
      "description": "Bundle the run-task.cjs script needed for \"projen eject\"",
      "steps": [
        {
          "exec": "esbuild src/task-runtime.ts --outfile=lib/run-task.cjs --bundle --platform=node --format=cjs --external:\"*/package.json\" --banner:js=\"#!/usr/bin/env node\" --footer:js=\"const runtime = new TaskRuntime(\\\".\\\");\nruntime.runTask(process.argv[2]);\""
        }
      ]
    },
    "check-licenses": {
      "name": "check-licenses",
      "steps": [
        {
          "exec": "license-checker --summary --production --onlyAllow \"MIT;ISC;BSD;BSD-2-Clause;BSD-3-Clause;Apache-2.0;Python-2.0\"",
          "receiveArgs": true
        }
      ]
    },
    "clobber": {
      "name": "clobber",
      "description": "hard resets to HEAD of origin and cleans the local repo",
      "env": {
        "BRANCH": "$(git branch --show-current)"
      },
      "steps": [
        {
          "exec": "git checkout -b scratch",
          "name": "save current HEAD in \"scratch\" branch"
        },
        {
          "exec": "git checkout $BRANCH"
        },
        {
          "exec": "git fetch origin",
          "name": "fetch latest changes from origin"
        },
        {
          "exec": "git reset --hard origin/$BRANCH",
          "name": "hard reset to origin commit"
        },
        {
          "exec": "git clean -fdx",
          "name": "clean all untracked files"
        },
        {
          "say": "ready to rock! (unpushed commits are under the \"scratch\" branch)"
        }
      ],
      "condition": "git diff --exit-code > /dev/null"
    },
    "compat": {
      "name": "compat",
      "description": "Perform API compatibility check against latest version",
      "steps": [
        {
          "exec": "jsii-diff npm:$(node -p \"require('./package.json').name\") -k --ignore-file .compatignore || (echo \"\nUNEXPECTED BREAKING CHANGES: add keys such as 'removed:constructs.Node.of' to .compatignore to skip.\n\" && exit 1)"
        }
      ]
    },
    "compile": {
      "name": "compile",
      "description": "Only compile",
      "steps": [
        {
          "exec": "jsii --silence-warnings=reserved-word"
        }
      ]
    },
    "contributors:update": {
      "name": "contributors:update",
      "steps": [
        {
          "exec": "all-contributors check | grep \"Missing contributors\" -A 1 | tail -n1 | sed -e \"s/,//g\" | xargs -n1 | grep -v \"\\[bot\\]\" | grep -v \"cdklabs-automation\" | grep -v \"projen-automation\" | xargs -n1 -I{} all-contributors add {} code"
        }
      ]
    },
    "default": {
      "name": "default",
      "description": "Synthesize project files",
      "steps": [
        {
          "exec": "ts-node --project tsconfig.dev.json .projenrc.ts"
        }
      ]
    },
    "devenv:setup": {
      "name": "devenv:setup",
      "steps": [
        {
          "exec": "npm ci"
        },
        {
          "spawn": "build"
        }
      ]
    },
    "docgen": {
      "name": "docgen",
      "description": "Generate API.md from .jsii manifest",
      "steps": [
        {
          "exec": "jsii-docgen .jsii -o docs/api/projen --split-by-submodule"
        }
      ]
    },
    "eject": {
      "name": "eject",
      "description": "Remove projen from the project",
      "env": {
        "PROJEN_EJECTING": "true"
      },
      "steps": [
        {
          "spawn": "default"
        }
      ]
    },
    "eslint": {
      "name": "eslint",
      "description": "Runs eslint against the codebase",
      "env": {
        "ESLINT_USE_FLAT_CONFIG": "false",
        "NODE_NO_WARNINGS": "1"
      },
      "steps": [
        {
          "exec": "eslint --ext .ts,.tsx --fix --no-error-on-unmatched-pattern $@ src test build-tools projenrc .projenrc.ts",
          "receiveArgs": true
        }
      ]
    },
    "install": {
      "name": "install",
      "description": "Install project dependencies and update lockfile (non-frozen)",
      "steps": [
        {
          "exec": "npm install"
        }
      ]
    },
    "install:ci": {
      "name": "install:ci",
      "description": "Install project dependencies using frozen lockfile",
      "steps": [
        {
          "exec": "npm ci"
        }
      ]
    },
    "integ": {
      "name": "integ",
      "description": "Run integration tests",
      "steps": [
        {
          "spawn": "compile"
        },
        {
          "spawn": "package:python"
        },
        {
          "spawn": "integ:python-compat"
        }
      ]
    },
    "integ:python-compat": {
      "name": "integ:python-compat",
      "description": "Checks that projen's submodule structure does not cause import failures for python. Expects python to be installed and projen to be fully built.",
      "steps": [
        {
          "exec": "scripts/python-compat.sh"
        }
      ]
    },
    "package": {
      "name": "package",
      "description": "Creates the distribution package",
      "steps": [
        {
          "spawn": "transform-package-json"
        },
        {
          "spawn": "package:js",
          "condition": "node -e \"if (!process.env.CI) process.exit(1)\""
        },
        {
          "spawn": "package-all",
          "condition": "node -e \"if (process.env.CI) process.exit(1)\""
        }
      ]
    },
    "package-all": {
      "name": "package-all",
      "description": "Packages artifacts for all target languages",
      "steps": [
        {
          "spawn": "package:js"
        },
        {
          "spawn": "package:java"
        },
        {
          "spawn": "package:python"
        },
        {
          "spawn": "package:go"
        }
      ]
    },
    "package:go": {
      "name": "package:go",
      "description": "Create go language bindings",
      "steps": [
        {
          "exec": "jsii-pacmak -v --target go"
        }
      ]
    },
    "package:java": {
      "name": "package:java",
      "description": "Create java language bindings",
      "steps": [
        {
          "exec": "jsii-pacmak -v --target java"
        }
      ]
    },
    "package:js": {
      "name": "package:js",
      "description": "Create js language bindings",
      "steps": [
        {
          "exec": "jsii-pacmak -v --target js"
        }
      ]
    },
    "package:python": {
      "name": "package:python",
      "description": "Create python language bindings",
      "steps": [
        {
          "exec": "jsii-pacmak -v --target python"
        }
      ]
    },
    "post-compile": {
      "name": "post-compile",
      "description": "Runs after successful compilation",
      "steps": [
        {
          "spawn": "docgen"
        },
        {
          "spawn": "readme-macros"
        },
        {
          "spawn": "bundle:task-runner"
        },
        {
          "spawn": "default"
        },
        {
          "spawn": "vendor-bundle"
        },
        {
          "spawn": "rewrite-imports"
        }
      ]
    },
    "post-upgrade": {
      "name": "post-upgrade",
      "description": "Runs after upgrading dependencies"
    },
    "pre-compile": {
      "name": "pre-compile",
      "description": "Prepare the project for compilation",
      "steps": [
        {
          "spawn": "audit"
        },
        {
          "spawn": "check-licenses"
        }
      ]
    },
    "readme-macros": {
      "name": "readme-macros",
      "steps": [
        {
          "exec": "mv README.md README.md.bak"
        },
        {
          "exec": "cat README.md.bak | markmac > README.md"
        },
        {
          "exec": "rm README.md.bak"
        }
      ]
    },
    "release": {
      "name": "release",
      "description": "Prepare a release from \"main\" branch",
      "env": {
        "RELEASE": "true"
      },
      "steps": [
        {
          "exec": "rm -fr dist"
        },
        {
          "spawn": "bump"
        },
        {
          "spawn": "build"
        },
        {
          "spawn": "unbump"
        },
        {
          "exec": "git diff --ignore-space-at-eol --exit-code"
        }
      ]
    },
    "rewrite-imports": {
      "name": "rewrite-imports",
      "description": "Rewrite imports to use vendor bundle",
      "steps": [
        {
          "exec": "node -e \" try {   const { ImportRewriter } = require('./lib/javascript/import-rewriter');   const result = ImportRewriter.rewriteImports({     bundledDeps: [\\\"conventional-changelog-config-spec\\\",\\\"yaml\\\",\\\"yargs\\\",\\\"case\\\",\\\"fast-glob\\\",\\\"semver\\\",\\\"chalk\\\",\\\"@iarna/toml\\\",\\\"xmlbuilder2\\\",\\\"ini\\\",\\\"fast-json-patch\\\",\\\"comment-json\\\",\\\"parse-conflict-json\\\"],     externalDeps: [\\\"constructs\\\"],     libDir: 'lib',     vendorFile: 'vendor.js'   });   console.log('Rewrote ' + result.totalRewritten + ' imports in ' + result.files.length + ' files');   if (result.files.length > 0) {     result.files.forEach(f => console.log('  - ' + f.filePath + ': ' + f.rewrittenModules.join(', ')));   } } catch (e) {   console.error('ERROR: Failed to rewrite imports:', e.message);   console.error('\\nThis may indicate that the lib directory does not exist or ImportRewriter is not available.');   process.exit(1); } \"",
          "name": "rewrite-imports"
        }
      ]
    },
    "test": {
      "name": "test",
      "description": "Run tests",
      "steps": [
        {
          "exec": "jest --passWithNoTests --updateSnapshot",
          "receiveArgs": true
        },
        {
          "spawn": "eslint"
        }
      ]
    },
    "test:watch": {
      "name": "test:watch",
      "description": "Run jest in watch mode",
      "steps": [
        {
          "exec": "jest --watch"
        }
      ]
    },
    "transform-package-json": {
      "name": "transform-package-json",
      "description": "Transform package.json for publishing (remove bundled deps)",
      "steps": [
        {
          "exec": "node -e \" try {   const fs = require('fs');   if (!fs.existsSync('package.json')) {     console.error('ERROR: package.json not found');     process.exit(1);   }   const pkgContent = fs.readFileSync('package.json', 'utf-8');   let pkg;   try {     pkg = JSON.parse(pkgContent);   } catch (parseErr) {     console.error('ERROR: Failed to parse package.json:', parseErr.message);     process.exit(1);   }   const { PackageJsonTransformer } = require('./lib/javascript/package-json-transformer');   const result = PackageJsonTransformer.transform(pkg, {     removeDeps: [\\\"conventional-changelog-config-spec\\\",\\\"yaml\\\",\\\"yargs\\\",\\\"case\\\",\\\"fast-glob\\\",\\\"semver\\\",\\\"chalk\\\",\\\"@iarna/toml\\\",\\\"xmlbuilder2\\\",\\\"ini\\\",\\\"fast-json-patch\\\",\\\"comment-json\\\",\\\"parse-conflict-json\\\"],     removeBundledDependencies: true   });   fs.writeFileSync('package.json', JSON.stringify(result.packageJson, null, 2) + '\\n');   const removedCount = Object.keys(result.removedDeps).length;   if (removedCount > 0) {     console.log('Removed ' + removedCount + ' bundled dependencies from package.json:');     Object.keys(result.removedDeps).forEach(d => console.log('  - ' + d));   } else {     console.log('No bundled dependencies found in package.json to remove');   } } catch (e) {   console.error('ERROR: Failed to transform package.json:', e.message);   process.exit(1); } \"",
          "name": "transform-package-json"
        }
      ]
    },
    "unbump": {
      "name": "unbump",
      "description": "Restores version to 0.0.0",
      "env": {
        "OUTFILE": "package.json",
        "CHANGELOG": "dist/changelog.md",
        "BUMPFILE": "dist/version.txt",
        "RELEASETAG": "dist/releasetag.txt",
        "RELEASE_TAG_PREFIX": "",
        "BUMP_PACKAGE": "commit-and-tag-version@^12",
        "RELEASABLE_COMMITS": "git log --no-merges --oneline $LATEST_TAG..HEAD -E --grep \"^(feat|fix){1}(\\([^()[:space:]]+\\))?(!)?:[[:blank:]]+.+\""
      },
      "steps": [
        {
          "builtin": "release/reset-version"
        }
      ]
    },
    "upgrade": {
      "name": "upgrade",
      "description": "upgrade dependencies",
      "env": {
        "CI": "0",
        "NPM_CONFIG_BEFORE": "$(node -p \"new Date(Date.now()-172800000).toISOString()\")"
      },
      "steps": [
        {
          "exec": "npx npm-check-updates@18 --upgrade --target=minor --cooldown=2 --peer --no-deprecated --dep=dev,peer,prod,optional --filter=@jsii/check-node,@types/conventional-changelog-config-spec,@types/ini,@types/jest,@types/parse-conflict-json,@types/semver,@types/yargs,all-contributors-cli,aws-cdk-lib,esbuild,eslint-config-prettier,eslint-import-resolver-typescript,eslint-plugin-import,eslint-plugin-prettier,jest,jsii-diff,jsii-pacmak,json2jsii,license-checker,markmac,prettier,ts-jest,ts-node,shx"
        },
        {
          "exec": "npm install"
        },
        {
          "exec": "npm update @biomejs/biome @jsii/check-node @types/conventional-changelog-config-spec @types/ini @types/jest @types/node @types/parse-conflict-json @types/semver @types/yargs @typescript-eslint/eslint-plugin @typescript-eslint/parser all-contributors-cli aws-cdk-lib commit-and-tag-version esbuild eslint-config-prettier eslint-import-resolver-typescript eslint-plugin-import eslint-plugin-prettier eslint jest jest-junit jsii-diff jsii-docgen jsii-pacmak jsii-rosetta jsii json2jsii license-checker markmac prettier ts-jest ts-node typescript shx"
        },
        {
          "exec": "node ./projen.js"
        },
        {
          "spawn": "post-upgrade"
        }
      ]
    },
    "upgrade-bundled": {
      "name": "upgrade-bundled",
      "description": "upgrade bundled dependencies",
      "env": {
        "CI": "0",
        "NPM_CONFIG_BEFORE": "$(node -p \"new Date(Date.now()-172800000).toISOString()\")"
      },
      "steps": [
        {
          "exec": "npx npm-check-updates@18 --upgrade --target=minor --cooldown=2 --peer --no-deprecated --dep=dev,peer,prod,optional --filter=conventional-changelog-config-spec,yaml,yargs,case,fast-glob,semver,chalk,@iarna/toml,xmlbuilder2,ini,fast-json-patch,comment-json,parse-conflict-json"
        },
        {
          "exec": "npm install"
        },
        {
          "exec": "npm update conventional-changelog-config-spec yaml yargs case fast-glob semver chalk @iarna/toml xmlbuilder2 ini fast-json-patch comment-json parse-conflict-json"
        },
        {
          "exec": "node ./projen.js"
        },
        {
          "spawn": "post-upgrade"
        }
      ]
    },
    "vendor-bundle": {
      "name": "vendor-bundle",
      "description": "Generate vendor bundle from bundled dependencies",
      "steps": [
        {
          "exec": "node -e \" const fs = require('fs'); const path = require('path'); const deps = ['conventional-changelog-config-spec','yaml','yargs','case','fast-glob','semver','chalk','@iarna/toml','xmlbuilder2','ini','fast-json-patch','comment-json','parse-conflict-json']; const lines = ['// Auto-generated vendor entry point']; const missing = []; for (const dep of deps) {   try {     require.resolve(dep);     const id = dep.replace(/^@/, '').replace(/[^a-zA-Z0-9_]/g, '_');     lines.push('module.exports.' + id + ' = require(\\\"' + dep + '\\\");');   } catch (e) {     missing.push(dep);   } } if (missing.length > 0) {   console.error('ERROR: The following bundled dependencies are not installed:');   missing.forEach(d => console.error('  - ' + d));   console.error('\\nPlease run your package manager install command first.');   process.exit(1); } const dir = path.dirname('lib/.vendor-entry.js'); if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true }); fs.writeFileSync('lib/.vendor-entry.js', lines.join('\\n') + '\\n'); console.log('Generated vendor entry point with ' + deps.length + ' dependencies'); \"",
          "name": "generate-vendor-entry"
        },
        {
          "exec": "esbuild lib/.vendor-entry.js --bundle --outfile=lib/vendor.js --platform=node --format=cjs --target=node16 --tree-shaking=true --external:constructs",
          "name": "esbuild-vendor"
        },
        {
          "exec": "rm -f lib/.vendor-entry.js",
          "name": "cleanup-vendor-entry"
        }
      ]
    },
    "watch": {
      "name": "watch",
      "description": "Watch & compile in the background",
      "steps": [
        {
          "exec": "jsii -w --silence-warnings=reserved-word"
        }
      ]
    }
  },
  "env": {
    "PATH": "$(npx -c \"node --print process.env.PATH\")"
  },
  "//": "~~ Generated by projen. To modify, edit .projenrc.ts and run \"node ./projen.js\"."
}
