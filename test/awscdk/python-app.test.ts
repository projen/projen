import { awscdk, Testing } from "../../src";

test("create cdk python project", () => {
  const p = new awscdk.AwsCdkPythonApp({
    authorEmail: "test@cdkpythonapp.com",
    authorName: "First Last",
    moduleName: "test_cdk_python_app_project",
    name: "test-cdk-python-app-project",
    version: "0.1.0",
    cdkVersion: "2.8.0",
  });

  const snapshot = Testing.synth(p);
  expect(Object.keys(snapshot)).toStrictEqual([
    ".gitattributes",
    ".github/workflows/pull-request-lint.yml",
    ".gitignore",
    ".projen/deps.json",
    ".projen/files.json",
    ".projen/tasks.json",
    "app.py",
    "cdk.json",
    "README.md",
    "requirements-dev.txt",
    "requirements.txt",
    "test_cdk_python_app_project/__init__.py",
    "test_cdk_python_app_project/main.py",
    "tests/__init__.py",
    "tests/test_example.py",
  ]);
  expect(snapshot["cdk.json"]).toMatchSnapshot();
});

test("CDK v2 deps", () => {
  const p = new awscdk.AwsCdkPythonApp({
    authorEmail: "test@cdkpythonapp.com",
    authorName: "First Last",
    moduleName: "test_cdk_python_app_project",
    name: "test-cdk-python-app-project",
    version: "0.1.0",
    cdkVersion: "2.8.0",
  });

  const snapshot = Testing.synth(p);

  expect(
    snapshot["requirements-dev.txt"] ===
      `# ~~ Generated by projen. To modify, edit .projenrc.js and run "npx projen".
aws-cdk-lib>=2.8.0, <3.0.0
constructs>=10.0.5, <11.0.0
`
  );

  expect(
    snapshot["requirements-dev.txt"] ===
      `# ~~ Generated by projen. To modify, edit .projenrc.js and run "npx projen".
projen==99.99.99
pytest==6.2.1
`
  );
});

test("CDK v1 deps", () => {
  const p = new awscdk.AwsCdkPythonApp({
    authorEmail: "test@cdkpythonapp.com",
    authorName: "First Last",
    moduleName: "test_cdk_python_app_project",
    name: "test-cdk-python-app-project",
    version: "0.1.0",
    cdkVersion: "1.140.0",
  });

  const snapshot = Testing.synth(p);

  expect(
    snapshot["requirements-dev.txt"] ===
      `# ~~ Generated by projen. To modify, edit .projenrc.js and run "npx projen".
aws_cdk.core>=1.140.0, <2.0.0
constructs>=3.2.27, <4.0.0
`
  );

  expect(
    snapshot["requirements-dev.txt"] ===
      `# ~~ Generated by projen. To modify, edit .projenrc.js and run "npx projen".
projen==99.99.99
pytest==6.2.1
`
  );
});
