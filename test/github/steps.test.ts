import { synthSnapshot, TestProject } from "../util";

describe("workflow steps", () => {
  test("can synth all options", () => {
    // GIVEN
    const project = new TestProject();
    const wf = project.github?.addWorkflow("my-workflow");

    // WHEN
    wf?.addJob("foobar", {
      permissions: {},
      steps: [
        {
          if: "${{ true }}",
          id: "foobar",
          continueOnError: true,
          env: {
            ONE: "two",
          },
          name: "test name",
          run: 'echo "test"',
          shell: "bash",
          timeoutMinutes: 10,
          workingDirectory: "/",
        },
      ],
    });

    // THEN
    const snap = synthSnapshot(project)[".github/workflows/my-workflow.yml"];
    expect(snap).toMatchInlineSnapshot(`
      "# ~~ Generated by projen. To modify, edit .projenrc.js and run "npx projen".

      name: my-workflow
      on: {}
      jobs:
        foobar:
          permissions: {}
          steps:
            - name: test name
              id: foobar
              if: \${{ true }}
              env:
                ONE: two
              run: echo "test"
              shell: bash
              continue-on-error: true
              timeout-minutes: 10
              working-directory: /
      "
    `);
  });
});
